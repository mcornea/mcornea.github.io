<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Lab - basic OSPF routing scenario</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">        
        <meta name="description" content="Harmony is a free responsive jekyll theme by Gayan Virajith and Maheshika Lakmali. Sourced on Github -  https://github.com/gayanvirajith/harmony
">
        <link rel="canonical" 
        href="https://remote-lab.net//basic-ospf-routing-lab">
        
        <!-- Harmony styles -->
        <link rel="stylesheet" type="text/css" href="https://remote-lab.net/assets/css/main.css">

        <!-- Modernizr js -->
        <script async src="https://remote-lab.net/assets/js/modernizr.js"></script>    

        <!-- IE Fixes -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->        
    </head>
    <body class="theme-base-01">
        <header class="main-header">
            <div class="wc-container">
                <h1><a href="https://remote-lab.net/">remote-lab.net</a></h1>
                <h2>learn by doing</h2>
                <ul>
	<li>
		<a href="https://remote-lab.net">Home</a><span>/</span>
	</li>
	<li>
		<a href="https://remote-lab.net//about">About</a><span>/</span>
	</li>
	<li>
		<a href="https://remote-lab.net//blog">Blog</a><span>/</span>
	</li>
	<li>
		<a href="https://compute.remote-lab.net" target="_blank">Compute</a><span>/</span>
	</li>
</ul>
                
            </div>
        </header>
        <div class="page-content wc-container">
	
	<div class="post">
		<h1>Lab - basic OSPF routing scenario</h1>
		<p class="post-meta">
			
      <span class="categories">
      linux, switching, routing, and veos
      </span> |
	    
	    <span class="post-date">
    	May 21, 2014 
	    </span>
		</p>		
		<div class="post">
			<p>In this post post we’ll see how we can do a basic routing scenario by using the remote-lab.net virtual appliances. Below is the logical diagram of the scenario. Our objective is to esatblish connectivity between the 2 clients: host01 - 10.0.0.10 and host02 - 10.0.1.10. </p>

<hr />

<p>Each of the hosts will be connected to a router that  will be the first hop router for the hosts subnet. The 2 routers will be connected by 2 redundant links. We’ll set up OSPF as a routing protocol between the 2 routers that will be used to advertise the clients subnets. 
rtr01 is an Arista vEOS and rtr02 is running Vyatta core. host01 and host02 are running Debian.
<a href="https://remote-lab.net/assets/static/routing-lab-New-Page.png"><img src="https://remote-lab.net/assets/static/routing-lab-New-Page.png" alt="ospf routing lab logical" width="821" height="729" class="aligncenter size-full wp-image-260" /></a></p>

<p>Now let’s get to the physical setup (which is actually virtual as all the components are VMs ). Each system (clients and routers) will be connected to the layer 2 switch (openvswitch running on Linux). We’ll need to set up the links that connect the routers to the switch as trunks in order to allow multiple vlans to get through. The ports that connect the clients to the switch will be set as access ports. Please note that in a real world scenario you’ll need to connect the routers by 2 different physical links across separate geographical paths to ensure rendundancy. Below is the physical diagram of the setup.</p>

<p><a href="https://remote-lab.net/assets/static/routing-physical-New-Page.png"><img src="https://remote-lab.net/assets/static/routing-physical-New-Page.png" alt="routing lab physical" width="745" height="625" class="aligncenter size-full wp-image-259" /></a></p>

<p>First thing we need to do is to configure the openvswitch. We’ll create a bridge that contains all the ports and set up the client ports in access mode. By default all the openvswitch ports are trunks.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">lab@console01:~&gt;&gt;&gt; ovs01
root@ovs01:~&gt;&gt;&gt; <span class="k">for</span> i in <span class="o">{</span>1..4<span class="o">}</span><span class="p">;</span> <span class="k">do</span> ip l <span class="nb">set </span>dev eth<span class="nv">$i</span> up<span class="p">;</span><span class="k">done</span>
root@ovs01:~&gt;&gt;&gt; ovs-vsctl add-br l2switch
root@ovs01:~&gt;&gt;&gt; ovs-vsctl add-port l2switch eth1 <span class="nv">tag</span><span class="o">=</span>10
root@ovs01:~&gt;&gt;&gt; ovs-vsctl add-port l2switch eth2 <span class="nv">tag</span><span class="o">=</span>20
root@ovs01:~&gt;&gt;&gt; ovs-vsctl add-port l2switch eth3
root@ovs01:~&gt;&gt;&gt; ovs-vsctl add-port l2switch eth4
root@ovs01:~&gt;&gt;&gt; ovs-vsctl show
653dfcd6-85a4-4f72-995f-9fa05b5203f9
    Bridge <span class="s2">&quot;l2switch&quot;</span>
        Port <span class="s2">&quot;l2switch&quot;</span>
            Interface <span class="s2">&quot;l2switch&quot;</span>
                <span class="nb">type</span>: internal
        Port <span class="s2">&quot;eth3&quot;</span>
            Interface <span class="s2">&quot;eth3&quot;</span>
        Port <span class="s2">&quot;eth2&quot;</span>
            tag: 20
            Interface <span class="s2">&quot;eth2&quot;</span>
        Port <span class="s2">&quot;eth4&quot;</span>
            Interface <span class="s2">&quot;eth4&quot;</span>
        Port <span class="s2">&quot;eth1&quot;</span>
            tag: 10
            Interface <span class="s2">&quot;eth1&quot;</span>
    ovs_version: <span class="s2">&quot;1.9.3&quot;</span></code></pre></div>

<p>Set up the client interfaces IP addresses and default routes:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">lab@console01:~&gt;&gt;&gt; host01
root@host01:~&gt;&gt;&gt; ip l <span class="nb">set </span>dev eth1 up
root@host01:~&gt;&gt;&gt; ip addr add 10.0.0.10/24 dev eth1
root@host01:~&gt;&gt;&gt; ip route add default via 10.0.0.1
lab@console01:~&gt;&gt;&gt; host02
root@host02:~&gt;&gt;&gt; ip l <span class="nb">set </span>dev eth1 up
root@host02:~&gt;&gt;&gt; ip addr add 10.0.1.10/24 dev eth1
root@host01:~&gt;&gt;&gt; ip route add default via 10.0.1.1</code></pre></div>

<p>Configure the vlans and SVI IP addresses on the routers:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">lab@console01:~&gt;&gt;&gt; rtr01
rtr01&gt;en
rtr01#configure
rtr01<span class="o">(</span>config<span class="o">)</span><span class="c">#vlan 10</span>
rtr01<span class="o">(</span>config-vlan-10<span class="o">)</span><span class="c">#name host01-vlan</span>
rtr01<span class="o">(</span>config-vlan-10<span class="o">)</span><span class="c">#vlan 100</span>
rtr01<span class="o">(</span>config-vlan-100<span class="o">)</span><span class="c">#name path1-vlan</span>
rtr01<span class="o">(</span>config-vlan-100<span class="o">)</span><span class="c">#vlan 200</span>
rtr01<span class="o">(</span>config-vlan-200<span class="o">)</span><span class="c">#name path2-vlan</span>
rtr01<span class="o">(</span>config<span class="o">)</span><span class="c">#int ethernet 1</span>
rtr01<span class="o">(</span>config-if-Et1<span class="o">)</span><span class="c">#switchport mode trunk</span>
rtr01<span class="o">(</span>config-if-Et1<span class="o">)</span><span class="c">#switchport trunk allowed vlan 10,100,200</span>
rtr01<span class="o">(</span>config-vlan-200<span class="o">)</span><span class="c">#int vlan 10</span>
rtr01<span class="o">(</span>config-if-Vl10<span class="o">)</span><span class="c">#ip address 10.0.0.1/24</span>
rtr01<span class="o">(</span>config-if-Et1<span class="o">)</span><span class="c">#int vlan 100</span>
rtr01<span class="o">(</span>config-if-Vl100<span class="o">)</span><span class="c">#ip address 192.168.0.1/30</span>
rtr01<span class="o">(</span>config-if-Vl100<span class="o">)</span><span class="c">#int vlan 200</span>
rtr01<span class="o">(</span>config-if-Vl200<span class="o">)</span><span class="c">#ip address 192.168.0.5/30                                                         </span>
lab@console01:~&gt;&gt;&gt; rtr02
admin@rtr02:~&gt;&gt;&gt; configure
<span class="o">[</span>edit<span class="o">]</span>
admin@rtr02# <span class="nb">set </span>interfaces ethernet eth1 vif <span class="m">20</span> address 10.0.1.1/24
<span class="o">[</span>edit<span class="o">]</span>
admin@rtr02# <span class="nb">set </span>interfaces ethernet eth1 vif <span class="m">100</span> address 192.168.0.2/30
<span class="o">[</span>edit<span class="o">]</span>
admin@rtr02# <span class="nb">set </span>interfaces ethernet eth1 vif <span class="m">200</span> address 192.168.0.6/30
admin@rtr02# commit
<span class="o">[</span>edit<span class="o">]</span>
admin@rtr02# save
Saving configuration to <span class="s1">&#39;/config/config.boot&#39;</span>...
Done</code></pre></div>

<p>Let’s do some connectivity tests:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">rtr01&gt;ping 10.0.0.10
PING 10.0.0.10 <span class="o">(</span>10.0.0.10<span class="o">)</span> 72<span class="o">(</span>100<span class="o">)</span> bytes of data.
<span class="m">80</span> bytes from 10.0.0.10: <span class="nv">icmp_req</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nb">time</span><span class="o">=</span>12.9 ms    
rtr01&gt;ping 192.168.0.2
PING 192.168.0.2 <span class="o">(</span>192.168.0.2<span class="o">)</span> 72<span class="o">(</span>100<span class="o">)</span> bytes of data.
<span class="m">80</span> bytes from 192.168.0.2: <span class="nv">icmp_req</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nb">time</span><span class="o">=</span>16.7 ms                
rtr01&gt;ping 192.168.0.6
PING 192.168.0.6 <span class="o">(</span>192.168.0.6<span class="o">)</span> 72<span class="o">(</span>100<span class="o">)</span> bytes of data.
<span class="m">80</span> bytes from 192.168.0.6: <span class="nv">icmp_req</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nb">time</span><span class="o">=</span>13.2 ms       
admin@rtr02:~&gt;&gt;&gt; ping 10.0.1.10
PING 10.0.1.10 <span class="o">(</span>10.0.1.10<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
<span class="m">64</span> bytes from 10.0.1.10: <span class="nv">icmp_req</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nb">time</span><span class="o">=</span>3.74 ms</code></pre></div>

<p>Now that we have the connectivity established on the connected links let’s move forward and set up OSPF :</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">lab@console01:~&gt;&gt;&gt; rtr01
rtr01&gt;en
rtr01#configure
rtr01<span class="o">(</span>config<span class="o">)</span><span class="c">#ip routing</span>
rtr01<span class="o">(</span>config<span class="o">)</span><span class="c">#router ospf 10</span>
rtr01<span class="o">(</span>config-router-ospf<span class="o">)</span><span class="c">#network 10.0.0.1 0.0.0.0 area 0</span>
rtr01<span class="o">(</span>config-router-ospf<span class="o">)</span><span class="c">#network 192.168.0.1 0.0.0.0 area 0</span>
rtr01<span class="o">(</span>config-router-ospf<span class="o">)</span><span class="c">#network 192.168.0.5 0.0.0.0 area 0 </span>
lab@console01:~&gt;&gt;&gt; rtr02
admin@rtr02:~&gt;&gt;&gt; configure
<span class="o">[</span>edit<span class="o">]</span>
admin@rtr02#
admin@rtr02# <span class="nb">set </span>protocols ospf area <span class="m">0</span> network 10.0.1.0/24
<span class="o">[</span>edit<span class="o">]</span>
admin@rtr02# <span class="nb">set </span>protocols ospf area <span class="m">0</span> network 192.168.0.0/30
<span class="o">[</span>edit<span class="o">]</span>
admin@rtr02# <span class="nb">set </span>protocols ospf area <span class="m">0</span> network 192.168.0.4/30
admin@rtr02# commit</code></pre></div>

<p>Once that we have the ospf configuration done we can proceed and check the OSPF neighbor status on the 2 routers. We’ll see that we have 2 equal cost paths to the hosts subnets. This means that the routers will load balance the packets through the 2 links.      </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">rtr01#show ip ospf neighbor
Neighbor ID     VRF    Pri   State            Dead Time   Address         Interface
172.16.18.5     default    <span class="m">1</span>   FULL/BDR         00:00:31    192.168.0.6     Vlan200
172.16.18.5     default    <span class="m">1</span>   FULL/DR          00:00:31    192.168.0.2     Vlan100    
rtr01#show ip route 10.0.1.0/24
Codes: C - connected, S - static, K - kernel,
       O - OSPF, IA - OSPF inter area, E1 - OSPF external <span class="nb">type </span>1,
       E2 - OSPF external <span class="nb">type </span>2, N1 - OSPF NSSA external <span class="nb">type </span>1,
       N2 - OSPF NSSA external type2, B I - iBGP, B E - eBGP,
       R - RIP, I - ISIS, A B - BGP Aggregate, A O - OSPF Summary                                                                                                                             
 O      10.0.1.0/24 <span class="o">[</span>110/20<span class="o">]</span> via 192.168.0.2, Vlan100
                             via 192.168.0.6, Vlan200                     
admin@rtr02:~&gt;&gt;&gt; show ip ospf neighbor 
    Neighbor ID Pri State           Dead Time Address         Interface            RXmtL RqstL DBsmL
192.168.0.5       <span class="m">1</span> Full/Backup       36.750s 192.168.0.1     eth1.100:192.168.0.2     <span class="m">0</span>     <span class="m">0</span>     0
192.168.0.5       <span class="m">1</span> Full/DR           36.960s 192.168.0.5     eth1.200:192.168.0.6     <span class="m">0</span>     <span class="m">0</span>     <span class="m">0</span> 
admin@rtr02:~&gt;&gt;&gt; show ip route 10.0.0.0/24
Routing entry <span class="k">for</span> 10.0.0.0/24
  Known via <span class="s2">&quot;ospf&quot;</span>, distance 110, metric 20, best
  Last update 00:04:42 ago
  * 192.168.0.1, via eth1.100
  * 192.168.0.5, via eth1.200</code></pre></div>

<p>What if we want to set one of the links as primary ? We need to set a higher cost for the secondary link. At this time both of the paths have a cost of 20 (10 for the network segment that connects the 2 routers + 10 for the host network segment). Let’schoose the vlan 200 as secondary and increase the cost for the secondary link to 11.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">rtr01#configure
rtr01<span class="o">(</span>config<span class="o">)</span><span class="c">#int vlan 200</span>
rtr01<span class="o">(</span>config-if-Vl200<span class="o">)</span><span class="c">#ip ospf cost 11</span>
rtr01<span class="o">(</span>config-if-Vl200<span class="o">)</span><span class="c">#show ip route 10.0.1.0/24</span>
Codes: C - connected, S - static, K - kernel,
       O - OSPF, IA - OSPF inter area, E1 - OSPF external <span class="nb">type </span>1,
       E2 - OSPF external <span class="nb">type </span>2, N1 - OSPF NSSA external <span class="nb">type </span>1,
       N2 - OSPF NSSA external type2, B I - iBGP, B E - eBGP,
       R - RIP, I - ISIS, A B - BGP Aggregate, A O - OSPF Summary                                                                                                                             
 O      10.0.1.0/24 <span class="o">[</span>110/20<span class="o">]</span> via 192.168.0.2, Vlan100</code></pre></div>

<p>We can see that the routing table only contains the vlan 100 path. What happens if vlan 100 goes down ? </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">rtr01<span class="o">(</span>config<span class="o">)</span><span class="c">#int vlan 100</span>
rtr01<span class="o">(</span>config-if-Vl100<span class="o">)</span><span class="c">#shut</span>
rtr01<span class="o">(</span>config-if-Vl100<span class="o">)</span><span class="c">#show ip route 10.0.1.0/24</span>
Codes: C - connected, S - static, K - kernel,
       O - OSPF, IA - OSPF inter area, E1 - OSPF external <span class="nb">type </span>1,
       E2 - OSPF external <span class="nb">type </span>2, N1 - OSPF NSSA external <span class="nb">type </span>1,
       N2 - OSPF NSSA external type2, B I - iBGP, B E - eBGP,
       R - RIP, I - ISIS, A B - BGP Aggregate, A O - OSPF Summary                                                                                                                             
 O      10.0.1.0/24 <span class="o">[</span>110/21<span class="o">]</span> via 192.168.0.6, Vlan200</code></pre></div>

<p>We can see that the vlan 200 path is installed in the routing table with a cost of 21 ( 11 + 10).</p>

<p>I hope this post is useful for getting an idea of how you can use the virtual lab. Please let me know if you any questions.                                                             </p>

		</div>
	</div>


	
	<div class="related">
		<h4>Related Posts</h2>
		<ul class="posts">
		    
		    <li>
			  <span>05 Apr 2015 &raquo;</span>
			  <a href="https://remote-lab.net//getting-started-with-docker">Getting started with Docker and the wonders of Open Source</a>
		    </li>
		    
		    <li>
			  <span>24 Feb 2015 &raquo;</span>
			  <a href="https://remote-lab.net//opsf-on-ios-with-ansible">OSPF lab provisioning on IOS with Ansible</a>
		    </li>
		    
		    <li>
			  <span>12 Oct 2014 &raquo;</span>
			  <a href="https://remote-lab.net//sdn-intro-basic-with-ovs-and-pox">SDN Intro: Basic L2 connectivity by using OVS and POX</a>
		    </li>
		    
		</ul>
	</div>
	

	<div class="post-footer">
		<div class="column-1">
			
				<a href="https://remote-lab.net//virtualized-application-infrastructure"><< Older</a>
			
		</div>
		<div class="column-2"><a href="https://remote-lab.net// ">Home</a></div>
		<div class="column-3">
			
				<a href="https://remote-lab.net//ansible-postfix-with-mandrill">Newer >></a>
			
		</div>
	</div>
</div>
 

        <footer class="main-footer">
            <div class="wc-container">
                <div class="column one">
                    <h6>Few more links</h6>
<ul class="menu">
    <li><a href="https://remote-lab.net//about">About</a></li>
    <li><a href="https://remote-lab.net//blogroll">Blogroll</a></li>
</ul>		
                    
                </div>
                <div class="column two">
                    <h6>Follow me</h6>

<ul class="social-media">


    
    <li>
        <a title="remoteur on Twitter" 
            href="https://twitter.com/remoteur" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="remoteur on Github" 
            href="https://github.com/remoteur" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    
    <li>
        <a title="marius.catalin.31542 on Facebook" 
            href="https://facebook.com/marius.catalin.31542" 
            class="facebook wc-img-replace" target="_blank">Facebook</a>
    </li>
    

    

    

    

</ul>
                </div>
            </div>
            <p class="wc-container disclaimer">
                
Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>
            </p>
        </footer>
        <script type="text/javascript">
          /* To avoid render blocking css */
          var cb = function() {
            var l = document.createElement('link'); l.rel = 'stylesheet';
            l.href = 'https://fonts.googleapis.com/css?family=Ubuntu+Mono&subset=latin';
            var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
          };
          var raf = requestAnimationFrame || mozRequestAnimationFrame ||
              webkitRequestAnimationFrame || msRequestAnimationFrame;
          if (raf) raf(cb);
          else window.addEventListener('load', cb);
        </script>
        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="https://remote-lab.net//assets/js/jquery.min.js"><\/script>')</script>
        <!-- Site js -->
        <script src="https://remote-lab.net/assets/js/all.js"></script>
        <!-- Google analytics  -->
        
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    </body>        
</html>
