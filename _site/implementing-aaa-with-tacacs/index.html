<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Implementing AAA with TACACS+</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">        
        <meta name="description" content="Harmony is a free responsive jekyll theme by Gayan Virajith and Maheshika Lakmali. Sourced on Github -  https://github.com/gayanvirajith/harmony
">
        <link rel="canonical" 
        href="http://remoteur.github.io:4000//implementing-aaa-with-tacacs">
        
        <!-- Harmony styles -->
        <link rel="stylesheet" type="text/css" href="http://remoteur.github.io:4000/assets/css/main.css">

        <!-- Modernizr js -->
        <script async src="http://remoteur.github.io:4000/assets/js/modernizr.js"></script>    

        <!-- IE Fixes -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->        
    </head>
    <body class="theme-base-01">
        <header class="main-header">
            <div class="wc-container">
                <h1><a href="http://remoteur.github.io:4000/">remote-lab.net</a></h1>
                <h2>learn by doing</h2>
                <ul>
	<li>
		<a href="http://remoteur.github.io:4000">Home</a><span>/</span>
	</li>
	<li>
		<a href="http://remoteur.github.io:4000//about">About</a><span>/</span>
	</li>
	<li>
		<a href="http://remoteur.github.io:4000//blog">Blog</a><span>/</span>
	</li>
	<li>
		<a href="https://compute.remote-lab.net" target="_blank">Compute</a><span>/</span>
	</li>
</ul>
                
            </div>
        </header>
        <div class="page-content wc-container">
	
	<div class="post">
		<h1>Implementing AAA with TACACS+</h1>
		<p class="post-meta">
			
      <span class="categories">
      linux and ios
      </span> |
	    
	    <span class="post-date">
    	Apr 5, 2013 
	    </span>
		</p>		
		<div class="post">
			<p>In today’s post I will showw how you can do a basic configuration of a TACACS+ Linux server and how to enable the AAA on the networking device.
To start with AAA, stands for Authentication, Authorization and Accounting. The authentication is related to the login process: users and their passwords, authorization describes what each of the users is allowed to do on the device and the accounting part logs what commands the users have issued on the device. All these are implemented as a set of attributes stored in a database that can be located locally on the device or hosted remotely on a TACACS+ or RADIUS server.</p>

<hr />

<p><a href="http://remoteur.github.io:4000/assets/static/tacacs.gif"><img class="aligncenter size-medium wp-image-147" title="tacacs" src="http://remoteur.github.io:4000/assets/static/tacacs.gif" alt="" width="300" height="265" /></a></p>

<p>Installing TACACS+ Server:</p>

<p>I am using Debian Squeeze as OS. TACACS+ comes in Squeeze repositories so installing it is as simple as :</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">aptitude install tacacs+</code></pre></div>

<p>Its config file is located at /etc/tacacs+/tac_plus.conf. In order to start, stop, restart it you can use the init scripts.</p>

<p>Let’s do a basic configuration and add 2 users on the database: admin with full privileges and user having restricted access:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#This is the key used by the device to authenticate to the TACACS server.</span>
<span class="c">#We will also set it on the Cisco router</span>
<span class="nv">key</span> <span class="o">=</span> testing123 
<span class="c"># This is the admin user having full privileges.</span>
<span class="c"># You may generate the login encrypted password using the tac_pwd tool that comes with the tacacs+ package</span>
<span class="nv">user</span> <span class="o">=</span> admin <span class="o">{</span>
default <span class="nv">service</span> <span class="o">=</span> permit
<span class="nv">login</span> <span class="o">=</span> des RXs9NfUA2sKIE
<span class="nv">service</span> <span class="o">=</span> <span class="nb">exec</span> <span class="o">{</span>
priv-lvl <span class="o">=</span> 15
<span class="o">}</span>
<span class="o">}</span>
<span class="c"># This is the user having restricted privileges.</span>
<span class="c"># As you may see the default policy is deny for all the commands and we then set to allow the show ip * and show interface * commands, everything else is denied.</span>
<span class="nv">user</span> <span class="o">=</span> user <span class="o">{</span>
default <span class="nv">service</span> <span class="o">=</span> deny
<span class="nv">login</span> <span class="o">=</span> cleartext <span class="nb">test</span>
<span class="nv">cmd</span> <span class="o">=</span> show
<span class="o">{</span>
permit ip
permit interface
deny .*
<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Now let’s get to the client side - the Cisco router. We first have to tell the router that it should use TACACS for authentication and the IP address of the server with the authentication key to the server.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">aaa new-model
tacacs-server host <span class="nv">$IP_ADDR</span>
tacacs-server key <span class="nv">$SERVER_KEY</span> <span class="c">#the same as the one of the server: testing123</span></code></pre></div>

<p>Next we will configure the authentication methods:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">aaa authentication login vtymethod group tacacs+ <span class="nb">enable</span> <span class="c">#uses vtymethod list that first tries the tacacs method and if the server is not reachable users can log in using the enable password</span>
line vty <span class="m">0</span> 4
   login authentication vtymethod <span class="c">#we tell the router to use the vtymethod list for authenticating the users</span></code></pre></div>

<p>Now let’s get to the authorization part. We will set it for both privilege level 1 and 15 commands</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">aaa authorization config-commands <span class="c">#does authorization for the configuration mode commands</span>
aaa authorization commands <span class="m">1</span> default group tacacs+ none <span class="c">#uses the default authorization list which authorizes all the commands through tacacs and if the server is not reachable it won’t do any authorization</span>
aaa authorization commands <span class="m">15</span> default group tacacs+ none</code></pre></div>

<p>Accounting:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">aaa accounting <span class="nb">exec </span>default start-stop tacacs+</code></pre></div>

<p>In order to have accouting in place you also need to set the accounting log file location on the server:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">accounting <span class="nv">file</span> <span class="o">=</span> /var/log/tac_plus.acct</code></pre></div>

<p>Troubleshooting AAA issues can be done using the debug aaa command. Below is an example of the authorization debug for user when trying to enter configuration mode - which is not allowed and when issuing the show ip int brief command allowed:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">Mar <span class="m">1</span> 03:29:59.859: tty4 AAA/AUTHOR/CMD<span class="o">(</span>4247381793<span class="o">)</span>: <span class="nv">Port</span><span class="o">=</span><span class="s1">&#39;tty4&#39;</span> <span class="nv">list</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="nv">service</span><span class="o">=</span>CMD
*Mar <span class="m">1</span> 03:29:59.863: AAA/AUTHOR/CMD: tty4<span class="o">(</span>4247381793<span class="o">)</span> <span class="nv">user</span><span class="o">=</span><span class="s1">&#39;user&#39;</span>
*Mar <span class="m">1</span> 03:29:59.863: tty4 AAA/AUTHOR/CMD<span class="o">(</span>4247381793<span class="o">)</span>: send AV <span class="nv">service</span><span class="o">=</span>shell
*Mar <span class="m">1</span> 03:29:59.863: tty4 AAA/AUTHOR/CMD<span class="o">(</span>4247381793<span class="o">)</span>: send AV <span class="nv">cmd</span><span class="o">=</span>configure
*Mar <span class="m">1</span> 03:29:59.863: tty4 AAA/AUTHOR/CMD<span class="o">(</span>4247381793<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>terminal
*Mar <span class="m">1</span> 03:29:59.863: tty4 AAA/AUTHOR/CMD<span class="o">(</span>4247381793<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>
*Mar <span class="m">1</span> 03:29:59.863: tty4 AAA/AUTHOR/CMD<span class="o">(</span>4247381793<span class="o">)</span>: found list <span class="s2">&quot;default&quot;</span>
*Mar <span class="m">1</span> 03:29:59.863: tty4 AAA/AUTHOR/CMD<span class="o">(</span>4247381793<span class="o">)</span>: <span class="nv">Method</span><span class="o">=</span>tacacs+ <span class="o">(</span>tacacs+<span class="o">)</span>
*Mar <span class="m">1</span> 03:29:59.863: AAA/AUTHOR/TAC+: <span class="o">(</span>4247381793<span class="o">)</span>: <span class="nv">user</span><span class="o">=</span>user
*Mar <span class="m">1</span> 03:29:59.863: AAA/AUTHOR/TAC+: <span class="o">(</span>4247381793<span class="o">)</span>: send AV <span class="nv">service</span><span class="o">=</span>shell
*Mar <span class="m">1</span> 03:29:59.863: AAA/AUTHOR/TAC+: <span class="o">(</span>4247381793<span class="o">)</span>: send AV <span class="nv">cmd</span><span class="o">=</span>configure
*Mar <span class="m">1</span> 03:29:59.867: AAA/AUTHOR/TAC+: <span class="o">(</span>4247381793<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>terminal
*Mar <span class="m">1</span> 03:29:59.867: AAA/AUTHOR/TAC+: <span class="o">(</span>4247381793<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>
*Mar <span class="m">1</span> 03:30:00.071: TAC+: <span class="o">(</span>-47585503<span class="o">)</span>: received author response <span class="nv">status</span> <span class="o">=</span> FAIL
*Mar <span class="m">1</span> 03:30:00.071: AAA/AUTHOR <span class="o">(</span>4247381793<span class="o">)</span>: Post authorization <span class="nv">status</span> <span class="o">=</span> FAIL
*Mar <span class="m">1</span> 03:30:23.575: tty4 AAA/AUTHOR/CMD<span class="o">(</span>2242867480<span class="o">)</span>: <span class="nv">Port</span><span class="o">=</span><span class="s1">&#39;tty4&#39;</span> <span class="nv">list</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="nv">service</span><span class="o">=</span>CMD
*Mar <span class="m">1</span> 03:30:23.575: AAA/AUTHOR/CMD: tty4<span class="o">(</span>2242867480<span class="o">)</span> <span class="nv">user</span><span class="o">=</span><span class="s1">&#39;user&#39;</span>
*Mar <span class="m">1</span> 03:30:23.575: tty4 AAA/AUTHOR/CMD<span class="o">(</span>2242867480<span class="o">)</span>: send AV <span class="nv">service</span><span class="o">=</span>shell
*Mar <span class="m">1</span> 03:30:23.575: tty4 AAA/AUTHOR/CMD<span class="o">(</span>2242867480<span class="o">)</span>: send AV <span class="nv">cmd</span><span class="o">=</span>show
*Mar <span class="m">1</span> 03:30:23.575: tty4 AAA/AUTHOR/CMD<span class="o">(</span>2242867480<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>ip
*Mar <span class="m">1</span> 03:30:23.575: tty4 AAA/AUTHOR/CMD<span class="o">(</span>2242867480<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>interface
*Mar <span class="m">1</span> 03:30:23.575: tty4 AAA/AUTHOR/CMD<span class="o">(</span>2242867480<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>brief
*Mar <span class="m">1</span> 03:30:23.575: tty4 AAA/AUTHOR/CMD<span class="o">(</span>2242867480<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>
*Mar <span class="m">1</span> 03:30:23.575: tty4 AAA/AUTHOR/CMD<span class="o">(</span>2242867480<span class="o">)</span>: found list <span class="s2">&quot;default&quot;</span>
*Mar <span class="m">1</span> 03:30:23.583: tty4 AAA/AUTHOR/CMD<span class="o">(</span>2242867480<span class="o">)</span>: <span class="nv">Method</span><span class="o">=</span>tacacs+ <span class="o">(</span>tacacs+<span class="o">)</span>
*Mar <span class="m">1</span> 03:30:23.583: AAA/AUTHOR/TAC+: <span class="o">(</span>2242867480<span class="o">)</span>: <span class="nv">user</span><span class="o">=</span>user
*Mar <span class="m">1</span> 03:30:23.583: AAA/AUTHOR/TAC+: <span class="o">(</span>2242867480<span class="o">)</span>: send AV <span class="nv">service</span><span class="o">=</span>shell
*Mar <span class="m">1</span> 03:30:23.583: AAA/AUTHOR/TAC+: <span class="o">(</span>2242867480<span class="o">)</span>: send AV <span class="nv">cmd</span><span class="o">=</span>show
*Mar <span class="m">1</span> 03:30:23.583: AAA/AUTHOR/TAC+: <span class="o">(</span>2242867480<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>ip
*Mar <span class="m">1</span> 03:30:23.583: AAA/AUTHOR/TAC+: <span class="o">(</span>2242867480<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>interface
*Mar <span class="m">1</span> 03:30:23.583: AAA/AUTHOR/TAC+: <span class="o">(</span>2242867480<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>brief
*Mar <span class="m">1</span> 03:30:23.583: AAA/AUTHOR/TAC+: <span class="o">(</span>2242867480<span class="o">)</span>: send AV cmd-arg<span class="o">=</span>
*Mar <span class="m">1</span> 03:30:23.795: TAC+: <span class="o">(</span>-2052099816<span class="o">)</span>: received author response <span class="nv">status</span> <span class="o">=</span> PASS_ADD
*Mar <span class="m">1</span> 03:30:23.799: AAA/AUTHOR <span class="o">(</span>2242867480<span class="o">)</span>: Post authorization <span class="nv">status</span> <span class="o">=</span> PASS_ADD</code></pre></div>


		</div>
	</div>


	
	<div class="related">
		<h4>Related Posts</h2>
		<ul class="posts">
		    
		    <li>
			  <span>05 Apr 2015 &raquo;</span>
			  <a href="http://remoteur.github.io:4000//getting-started-with-docker">Getting started with Docker and the wonders of Open Source</a>
		    </li>
		    
		    <li>
			  <span>24 Feb 2015 &raquo;</span>
			  <a href="http://remoteur.github.io:4000//opsf-on-ios-with-ansible">OSPF lab provisioning on IOS with Ansible</a>
		    </li>
		    
		    <li>
			  <span>12 Oct 2014 &raquo;</span>
			  <a href="http://remoteur.github.io:4000//sdn-intro-basic-with-ovs-and-pox">SDN Intro: Basic L2 connectivity by using OVS and POX</a>
		    </li>
		    
		</ul>
	</div>
	

	<div class="post-footer">
		<div class="column-1">
			
				<a href="http://remoteur.github.io:4000//running-java-web-start-applications-on-ubuntu-12-04"><< Older</a>
			
		</div>
		<div class="column-2"><a href="http://remoteur.github.io:4000// ">Home</a></div>
		<div class="column-3">
			
				<a href="http://remoteur.github.io:4000//cisco-ios-dhcp-search-option">Newer >></a>
			
		</div>
	</div>
</div>
 

        <footer class="main-footer">
            <div class="wc-container">
                <div class="column one">
                    <h6>Few more links</h6>
<ul class="menu">
    <li><a href="http://remoteur.github.io:4000//about">About</a></li>
    <li><a href="http://remoteur.github.io:4000//blogroll">Blogroll</a></li>
</ul>		
                    
                </div>
                <div class="column two">
                    <h6>Follow me</h6>

<ul class="social-media">


    
    <li>
        <a title="remoteur on Twitter" 
            href="https://twitter.com/remoteur" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="remoteur on Github" 
            href="https://github.com/remoteur" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    
    <li>
        <a title="marius.catalin.31542 on Facebook" 
            href="https://facebook.com/marius.catalin.31542" 
            class="facebook wc-img-replace" target="_blank">Facebook</a>
    </li>
    

    

    

    

</ul>
                </div>
            </div>
            <p class="wc-container disclaimer">
                
Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>
            </p>
        </footer>
        <script type="text/javascript">
          /* To avoid render blocking css */
          var cb = function() {
            var l = document.createElement('link'); l.rel = 'stylesheet';
            l.href = 'http://fonts.googleapis.com/css?family=Ubuntu+Mono&subset=latin';
            var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
          };
          var raf = requestAnimationFrame || mozRequestAnimationFrame ||
              webkitRequestAnimationFrame || msRequestAnimationFrame;
          if (raf) raf(cb);
          else window.addEventListener('load', cb);
        </script>
        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="http://remoteur.github.io:4000//assets/js/jquery.min.js"><\/script>')</script>
        <!-- Site js -->
        <script src="http://remoteur.github.io:4000/assets/js/all.js"></script>
        <!-- Google analytics  -->
        
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    </body>        
</html>
