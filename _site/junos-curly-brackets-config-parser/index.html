<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>JunOS config interfaces IP address parser</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">        
        <meta name="description" content="remote-lab.net learn by doing Linux and networking tutorials https://remote-lab.net
">
        <link rel="canonical" 
        href="https://remote-lab.net//junos-curly-brackets-config-parser">
        
        <!-- Harmony styles -->
        <link rel="stylesheet" type="text/css" href="https://remote-lab.net/assets/css/main.css">

        <!-- Modernizr js -->
        <script async src="https://remote-lab.net/assets/js/modernizr.js"></script>    

        <!-- IE Fixes -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->        
    </head>
    <body class="theme-base-01">
        <header class="main-header">
            <div class="wc-container">
                <h1><a href="https://remote-lab.net/">remote-lab.net</a></h1>
                <h2>learn by doing</h2>
                <ul>
	<li>
		<a href="https://remote-lab.net">Home</a><span>/</span>
	</li>
	<li>
		<a href="https://remote-lab.net//about">About</a><span>/</span>
	</li>
	<li>
		<a href="https://remote-lab.net//blog">Blog</a><span>/</span>
	</li>
	<li>
		<a href="https://compute.remote-lab.net" target="_blank">Compute</a><span>/</span>
	</li>
	<li>
		<a href="https://remote-lab.net//docs">Docs</a><span>/</span>
	</li>
</ul>
                
            </div>
        </header>
        <div class="page-content wc-container">
	
	<div class="post">
		<h1>JunOS config interfaces IP address parser</h1>
		<p class="post-meta">
			
      <span class="categories">
      linux and automation
      </span> |
	    
	    <span class="post-date">
    	Feb 23, 2014 
	    </span>
		</p>		
		<div class="post">
			<p>In this post I will show how you can obtain an interface IP address out of a JunOS curly brackets configuration file. You may find below the script and also the source configuration file. Please note that in order to run the script both files need to be placed in the same directory. </p>

<hr />

<p>Please check it and let me know what you think, itâ€™s my first Perl script so it could definitely be improved.</p>

<div class="highlight"><pre><code class="language-perl" data-lang="perl"><span class="c1">#!/usr/bin/perl</span>
<span class="nb">open</span> <span class="p">(</span><span class="n">CONFIG</span><span class="p">,</span> <span class="s">&#39;config.txt&#39;</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$data</span> <span class="o">=</span> <span class="k">do</span> <span class="p">{</span> <span class="nb">local</span> <span class="vg">$/</span><span class="p">;</span> <span class="sr">&lt;CONFIG&gt;</span><span class="p">;};</span>
<span class="nb">close</span> <span class="p">(</span><span class="n">CONFIG</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$system</span> <span class="o">=</span> <span class="nv">$data</span> <span class="o">=~</span> <span class="sr">m{(\bsystem\s*({(?:(?&gt;[^{}</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="o">|</span><span class="p">(?</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">}))}</span>
    <span class="p">?</span> <span class="nv">$1</span>
    <span class="p">:</span> <span class="nb">die</span> <span class="s">&quot;system not found&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$intconfig</span> <span class="o">=</span> <span class="nv">$data</span> <span class="o">=~</span> <span class="sr">m{(\binterfaces\s*({(?:(?&gt;[^{}</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="o">|</span><span class="p">(?</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">}))}</span>
    <span class="p">?</span> <span class="nv">$1</span>
    <span class="p">:</span> <span class="nb">die</span> <span class="s">&quot;interfaces not found&quot;</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&#39;sys&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="nv">$system</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&#39;int&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span> <span class="nv">$ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">print</span> <span class="nv">$intconfig</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">defined</span> <span class="nv">$ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$int</span> <span class="o">=</span> <span class="nv">$intconfig</span> <span class="o">=~</span> <span class="sr">m{(\b$ARGV[1]\s*({(?:(?&gt;[^{}</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="o">|</span><span class="p">(?</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">}))}</span>
            <span class="p">?</span> <span class="nv">$1</span>
            <span class="p">:</span> <span class="nb">die</span> <span class="s">&quot;$ARGV[1] not found&quot;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span> <span class="nv">$ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">print</span> <span class="nv">$int</span><span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">defined</span> <span class="nv">$ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">my</span> <span class="nv">$unit</span> <span class="o">=</span> <span class="nv">$int</span> <span class="o">=~</span><span class="sr">m{(\bunit $ARGV[2]\s*({(?:(?&gt;[^{}</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="o">|</span><span class="p">(?</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">}))}</span>
                <span class="p">?</span> <span class="nv">$1</span>
                <span class="p">:</span> <span class="nb">die</span> <span class="s">&quot;$ARGV[2] not found&quot;</span><span class="p">;</span>
            <span class="k">my</span> <span class="nv">$inet</span> <span class="o">=</span> <span class="nv">$unit</span> <span class="o">=~</span> <span class="sr">m{(\bfamily inet\s*({(?:(?&gt;[^{}</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="o">|</span><span class="p">(?</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">}))}</span>
                <span class="p">?</span> <span class="nv">$1</span>
                <span class="p">:</span> <span class="nb">die</span> <span class="s">&quot;family inet not found in section&quot;</span><span class="p">;</span>
            <span class="k">my</span> <span class="nv">$inetaddr</span> <span class="o">=</span> <span class="nv">$inet</span> <span class="o">=~</span> <span class="sr">m{\baddress\s(\d{1,3}</span><span class="p">(?:</span><span class="o">\.\</span><span class="n">d</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">}){</span><span class="mi">3</span><span class="p">})}</span>
                <span class="p">?</span> <span class="nv">$1</span>
                <span class="p">:</span> <span class="nb">die</span> <span class="s">&quot;no IP address&quot;</span><span class="p">;</span>
            <span class="k">print</span> <span class="nv">$inetaddr</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&#39;--help&#39;</span> <span class="ow">or</span> <span class="o">!</span><span class="nb">defined</span> <span class="nv">$ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s">&quot;Usage : ./parser.pl sys                              # outputs system section config&quot;</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;        ./parser.pl int                              # outputs interfaces section config&quot;</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;        ./parser.pl int [int-name]                   # outputs specific interface section config&quot;</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;        ./parser.pl int ge-1/1/7                     # outputs ge-1/1/7 interface section config&quot;</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;        ./parser.pl int [int-name] [unit-id]         # outputs specific interface unit IP address&quot;</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;        ./parser.pl int ge-1/1/7 1001                # outputs ge-1/1/7 interface unit 1001 IP address&quot;</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="sr">&lt;/code&gt;</span>
<span class="o">&lt;</span><span class="n">code</span> <span class="n">lang</span><span class="o">=</span><span class="s">&quot;perl[notools]&quot;</span><span class="o">&gt;</span>
<span class="n">marius</span><span class="nv">@remoteur:</span><span class="o">~&gt;&gt;&gt;</span> <span class="n">cat</span> <span class="n">config</span><span class="o">.</span><span class="n">txt</span>
<span class="nb">system</span> <span class="p">{</span>
    <span class="n">host</span><span class="o">-</span><span class="n">name</span> <span class="n">junos</span><span class="o">-</span><span class="n">device</span><span class="p">;</span>
    <span class="n">domain</span><span class="o">-</span><span class="n">name</span> <span class="n">corporate</span><span class="o">.</span><span class="n">net</span>
    <span class="nb">time</span><span class="o">-</span><span class="n">zone</span> <span class="n">Europe</span><span class="o">/</span><span class="n">Bucharest</span><span class="p">;</span>
    <span class="n">default</span><span class="o">-</span><span class="n">address</span><span class="o">-</span><span class="n">selection</span><span class="p">;</span>
    <span class="nb">no</span><span class="o">-</span><span class="n">redirects</span><span class="p">;</span>
    <span class="n">location</span> <span class="n">country</span><span class="o">-</span><span class="n">code</span> <span class="n">RO</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">interfaces</span> <span class="p">{</span>
    <span class="ow">ge</span><span class="o">-</span><span class="mi">1</span><span class="sr">/0/</span><span class="mi">0</span> <span class="p">{</span>
        <span class="n">description</span> <span class="s">&quot;Core: R:core1 RP:ge-0/1/4 (ptp, isis)&quot;</span><span class="p">;</span>
        <span class="n">mtu</span> <span class="mi">9192</span><span class="p">;</span>
        <span class="n">unit</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">family</span> <span class="n">inet</span> <span class="p">{</span>
                <span class="n">address</span> <span class="mf">192.168.140.29</span><span class="o">/</span><span class="mi">31</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="ow">ge</span><span class="o">-</span><span class="mi">1</span><span class="sr">/0/</span><span class="mi">1</span> <span class="p">{</span>
        <span class="n">description</span> <span class="s">&quot;Cust: R:cust-a RP:ge-1/0/0 (srx240H)&quot;</span><span class="p">;</span>
        <span class="n">unit</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">family</span> <span class="n">inet</span> <span class="p">{</span>
                <span class="n">address</span> <span class="mf">172.16.166.196</span><span class="o">/</span><span class="mi">30</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="ow">ge</span><span class="o">-</span><span class="mi">1</span><span class="sr">/0/</span><span class="mi">2</span> <span class="p">{</span>
        <span class="n">flexible</span><span class="o">-</span><span class="n">vlan</span><span class="o">-</span><span class="n">tagging</span><span class="p">;</span>
        <span class="n">native</span><span class="o">-</span><span class="n">vlan</span><span class="o">-</span><span class="n">id</span> <span class="mi">10</span><span class="p">;</span>
        <span class="n">mtu</span> <span class="mi">9192</span><span class="p">;</span>
        <span class="n">unit</span> <span class="mi">10</span> <span class="p">{</span>
            <span class="n">description</span> <span class="s">&quot;Cust: R:cust-b (data, feed A)&quot;</span><span class="p">;</span>
            <span class="n">vlan</span><span class="o">-</span><span class="n">id</span> <span class="mi">10</span><span class="p">;</span>
            <span class="n">family</span> <span class="n">inet</span> <span class="p">{</span>
                <span class="n">address</span> <span class="mf">192.168.136.184</span><span class="o">/</span><span class="mi">31</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">unit</span> <span class="mi">1001</span> <span class="p">{</span>
            <span class="n">description</span> <span class="s">&quot;Core: R:cust-b (cpe management)&quot;</span><span class="p">;</span>
            <span class="n">vlan</span><span class="o">-</span><span class="n">id</span> <span class="mi">1001</span><span class="p">;</span>
            <span class="n">family</span> <span class="n">inet</span> <span class="p">{</span>
                <span class="n">filter</span> <span class="p">{</span>
                    <span class="n">output</span> <span class="n">Protect</span><span class="o">-</span><span class="n">cpe</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">address</span> <span class="mf">10.15.4.6</span><span class="o">/</span><span class="mi">30</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">ae0</span> <span class="p">{</span>
        <span class="n">description</span> <span class="s">&quot;Core: R:colo-vc2 RI:ae5&quot;</span><span class="p">;</span>
        <span class="n">aggregated</span><span class="o">-</span><span class="n">ether</span><span class="o">-</span><span class="n">options</span> <span class="p">{</span>
            <span class="n">minimum</span><span class="o">-</span><span class="n">links</span> <span class="mi">1</span><span class="p">;</span>
            <span class="nb">link</span><span class="o">-</span><span class="n">speed</span> <span class="mi">1</span><span class="n">g</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">unit</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">family</span> <span class="n">inet</span> <span class="p">{</span>
                <span class="n">address</span> <span class="mf">192.168.140.126</span><span class="o">/</span><span class="mi">31</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">lo0</span> <span class="p">{</span>
        <span class="n">unit</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">description</span> <span class="s">&quot;Core: R:primary routing loopback&quot;</span><span class="p">;</span>
            <span class="n">family</span> <span class="n">inet</span> <span class="p">{</span>
                <span class="n">address</span> <span class="mf">192.168.128.166</span><span class="o">/</span><span class="mi">32</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>


		</div>
	</div>


	
	<div class="related">
		<h4>Related Posts</h2>
		<ul class="posts">
		    
		    <li>
			  <span>05 Apr 2015 &raquo;</span>
			  <a href="https://remote-lab.net//getting-started-with-docker">Getting started with Docker and the wonders of Open Source</a>
		    </li>
		    
		    <li>
			  <span>24 Feb 2015 &raquo;</span>
			  <a href="https://remote-lab.net//opsf-on-ios-with-ansible">OSPF lab provisioning on IOS with Ansible</a>
		    </li>
		    
		    <li>
			  <span>12 Oct 2014 &raquo;</span>
			  <a href="https://remote-lab.net//sdn-intro-basic-with-ovs-and-pox">SDN Intro: Basic L2 connectivity by using OVS and POX</a>
		    </li>
		    
		</ul>
	</div>
	

	<div class="post-footer">
		<div class="column-1">
			
				<a href="https://remote-lab.net//linux-l2tp-ethernet-pseudowires"><< Older</a>
			
		</div>
		<div class="column-2"><a href="https://remote-lab.net// ">Home</a></div>
		<div class="column-3">
			
				<a href="https://remote-lab.net//junos-interfaces-ip-addresses-dns-records-generator">Newer >></a>
			
		</div>
	</div>
</div>
 

        <footer class="main-footer">
            <div class="wc-container">
                <div class="column one">
                    <h6>Few more links</h6>
<ul class="menu">
    <li><a href="https://remote-lab.net//about">About</a></li>
    <li><a href="https://remote-lab.net//blogroll">Blogroll</a></li>
</ul>		
                    
                </div>
                <div class="column two">
                    <h6>Follow me</h6>

<ul class="social-media">


    
    <li>
        <a title="remoteur on Twitter" 
            href="https://twitter.com/remoteur" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="remoteur on Github" 
            href="https://github.com/remoteur" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    
    <li>
        <a title="marius.catalin.31542 on Facebook" 
            href="https://facebook.com/marius.catalin.31542" 
            class="facebook wc-img-replace" target="_blank">Facebook</a>
    </li>
    

    

    

    

</ul>
                </div>
            </div>
            <p class="wc-container disclaimer">
                
Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>
            </p>
        </footer>
        <script type="text/javascript">
          /* To avoid render blocking css */
          var cb = function() {
            var l = document.createElement('link'); l.rel = 'stylesheet';
            l.href = 'https://fonts.googleapis.com/css?family=Ubuntu+Mono&subset=latin';
            var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
          };
          var raf = requestAnimationFrame || mozRequestAnimationFrame ||
              webkitRequestAnimationFrame || msRequestAnimationFrame;
          if (raf) raf(cb);
          else window.addEventListener('load', cb);
        </script>
        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="https://remote-lab.net//assets/js/jquery.min.js"><\/script>')</script>
        <!-- Site js -->
        <script src="https://remote-lab.net/assets/js/all.js"></script>
        <!-- Google analytics  -->
        
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    </body>        
</html>
