<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Pure-FTPd with MySQL backend</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">        
        <meta name="description" content="Harmony is a free responsive jekyll theme by Gayan Virajith and Maheshika Lakmali. Sourced on Github -  https://github.com/gayanvirajith/harmony
">
        <link rel="canonical" 
        href="http://remoteur.github.io//linux/2013/04/13/pure-ftpd-with-mysql-backend/">
        
        <!-- Harmony styles -->
        <link rel="stylesheet" type="text/css" href="http://remoteur.github.io/assets/css/main.css">

        <!-- Modernizr js -->
        <script async src="http://remoteur.github.io/assets/js/modernizr.js"></script>    

        <!-- IE Fixes -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->        
    </head>
    <body class="theme-base-01">
        <header class="main-header">
            <div class="wc-container">
                <h1><a href="http://remoteur.github.io/">remote-lab.net</a></h1>
                <h2>learn by doing</h2>
                <ul>
	<li>
		<a href="http://remoteur.github.io">Home</a><span>/</span>
	</li>
	<li>
		<a href="http://remoteur.github.io//about">About</a><span>/</span>
	</li>
	<li>
		<a href="http://remoteur.github.io//blog">Blog</a><span>/</span>
	</li>
	<li>
		<a href="https://compute.remote-lab.net" target="_blank">Compute</a><span>/</span>
	</li>
</ul>
                
            </div>
        </header>
        <div class="page-content wc-container">
	
	<div class="post">
		<h1>Pure-FTPd with MySQL backend</h1>
		<p class="post-meta">
			
      <span class="categories">
      linux
      </span> |
	    
	    <span class="post-date">
    	Apr 13, 2013 
	    </span>
		</p>		
		<div class="post">
			<p>This is a quick tutorial on how to install a clean FTP server with MySQL user database backend on a Debian based OS:</p>
<p>Install MySQL Server, Client and Pure-FTPd server:<br />
<code lang="c[notools]">aptitude install mysql-server mysql-client pure-ftpd-mysql</code></p>
<p>Connect to the MySQL server using the local console, create the database, grant privileges for the account the FTP server will use to connect to the DB, create the table that will store the user info and populate it:</p>
<p><code lang="c[notools]">mysql&gt; CREATE DATABASE pureftpd;<br />
mysql&gt; GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP ON pureftpd.* TO 'pureftpd'@'localhost' IDENTIFIED BY 'ftpdpass';<br />
mysql&gt; FLUSH PRIVILEGES;<br />
mysql&gt; USE pureftpd;<br />
mysql&gt; CREATE TABLE users (<br />
    -&gt; User varchar(16) NOT NULL default '',<br />
    -&gt; status enum('0','1') NOT NULL default '0',<br />
    -&gt; Password varchar(64) NOT NULL default '',<br />
    -&gt; Uid varchar(11) NOT NULL default '-1',<br />
    -&gt; Gid varchar(11) NOT NULL default '-1',<br />
    -&gt; Dir varchar(128) NOT NULL default '',<br />
    -&gt; comment tinytext NOT NULL,<br />
    -&gt; PRIMARY KEY (User),<br />
    -&gt; UNIQUE KEY User (User)<br />
    -&gt; ) TYPE=MyISAM;<br />
mysql&gt; insert into `users`  (`User`, `status`, `Password`, `Uid`, `Gid`, `Dir`, `comment`) values ('ftpuser', '1', md5('password'), '33', '33', '/var/www/', '');</code></p>
<p>Next, let's edit the config file used by the PureFTP server to connect to the MySQL server and query the database:</p>
<p><code lang="c[notools]">root@remote-lab:~# vim /etc/pure-ftpd/db/mysql.conf<br />
MYSQLSocket      /var/run/mysqld/mysqld.sock<br />
MYSQLServer     localhost<br />
MYSQLPort       3306<br />
MYSQLUser       pureftpd<br />
MYSQLPassword   ftpdpass<br />
MYSQLDatabase   pureftpd<br />
MYSQLCrypt      md5<br />
MYSQLGetPW      SELECT Password FROM users WHERE User="\L" AND status="1"<br />
MYSQLGetUID     SELECT Uid FROM users WHERE User="\L" AND status="1"<br />
MYSQLGetGID     SELECT Gid FROM users WHERE User="\L"AND status="1"<br />
MYSQLGetDir     SELECT Dir FROM users WHERE User="\L"AND status="1"</code></p>
<p>A couple of settings I find useful are to chroot the users in their directories and to set PureFTPd not to resolve hostnames. If you want to add users having an UID lower than 1000 you will also have to change the default config file. This is useful for instance if you add ftp users that need access to directories owned by www-data that has 33 UID. </p>
<p><code lang="c[notools]">echo "yes" &gt; /etc/pure-ftpd/conf/ChrootEveryone<br />
echo "yes" &gt; /etc/pure-ftpd/conf/DontResolve<br />
echo "33" &gt; /etc/pure-ftpd/conf/MinUID</code></p>
<p><code lang="c[notools]">/etc/init.d/pure-ftpd-mysql restart</code></p>
<p>And we should be up and running. </p>

		</div>
	</div>


	
	<div class="related">
		<h4>Related Posts</h2>
		<ul class="posts">
		    
		    <li>
			  <span>05 Apr 2015 &raquo;</span>
			  <a href="http://remoteur.github.io//getting-started-with-docker">Getting started with Docker and the wonders of Open Source</a>
		    </li>
		    
		    <li>
			  <span>24 Feb 2015 &raquo;</span>
			  <a href="http://remoteur.github.io//uncategorized/linux/routing/ios/python/2015/02/24/ospf-lab-provisioning-on-ios-with-ansible/">OSPF lab provisioning on IOS with Ansible</a>
		    </li>
		    
		    <li>
			  <span>12 Oct 2014 &raquo;</span>
			  <a href="http://remoteur.github.io//linux/switching/routing/virtualization/ios/python/2014/10/12/sdn-intro-basic-l2-connectivity-by-using-ovs-and-pox/">SDN Intro: Basic L2 connectivity by using OVS and POX</a>
		    </li>
		    
		</ul>
	</div>
	

	<div class="post-footer">
		<div class="column-1">
			
				<a href="http://remoteur.github.io//linux/ios/python/2013/04/12/cisco-ios-dhcp-search-option-2/"><< Older</a>
			
		</div>
		<div class="column-2"><a href="http://remoteur.github.io// ">Home</a></div>
		<div class="column-3">
			
				<a href="http://remoteur.github.io//routing/ios/2013/04/14/cisco-sdm/">Newer >></a>
			
		</div>
	</div>
</div>
 

        <footer class="main-footer">
            <div class="wc-container">
                <div class="column one">
                    <h6>Few more links</h6>
<ul class="menu">
    <li><a href="http://remoteur.github.io//about">About</a></li>
    <li><a href="http://remoteur.github.io//blogroll">Blogroll</a></li>
</ul>		
                    
                </div>
                <div class="column two">
                    <h6>Follow me</h6>

<ul class="social-media">


    
    <li>
        <a title="remoteur on Twitter" 
            href="https://twitter.com/remoteur" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="remoteur on Github" 
            href="https://github.com/remoteur" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    
    <li>
        <a title="marius.catalin.31542 on Facebook" 
            href="https://facebook.com/marius.catalin.31542" 
            class="facebook wc-img-replace" target="_blank">Facebook</a>
    </li>
    

    

    

    

</ul>
                </div>
            </div>
            <p class="wc-container disclaimer">
                
Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>
            </p>
        </footer>
        <script type="text/javascript">
          /* To avoid render blocking css */
          var cb = function() {
            var l = document.createElement('link'); l.rel = 'stylesheet';
            l.href = 'http://fonts.googleapis.com/css?family=Ubuntu+Mono&subset=latin';
            var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
          };
          var raf = requestAnimationFrame || mozRequestAnimationFrame ||
              webkitRequestAnimationFrame || msRequestAnimationFrame;
          if (raf) raf(cb);
          else window.addEventListener('load', cb);
        </script>
        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="http://remoteur.github.io//assets/js/jquery.min.js"><\/script>')</script>
        <!-- Site js -->
        <script src="http://remoteur.github.io/assets/js/all.js"></script>
        <!-- Google analytics  -->
        
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    </body>        
</html>
