<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>JunOS config interfaces IP address parser</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">        
        <meta name="description" content="Harmony is a free responsive jekyll theme by Gayan Virajith and Maheshika Lakmali. Sourced on Github -  https://github.com/gayanvirajith/harmony
">
        <link rel="canonical" 
        href="http://remoteur.github.io//linux/2014/02/23/junos-curly-brackets-configuration-parser/">
        
        <!-- Harmony styles -->
        <link rel="stylesheet" type="text/css" href="http://remoteur.github.io/assets/css/main.css">

        <!-- Modernizr js -->
        <script async src="http://remoteur.github.io/assets/js/modernizr.js"></script>    

        <!-- IE Fixes -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->        
    </head>
    <body class="theme-base-01">
        <header class="main-header">
            <div class="wc-container">
                <h1><a href="http://remoteur.github.io/">remote-lab.net</a></h1>
                <h2>learn by doing</h2>
                <ul>
	<li>
		<a href="http://remoteur.github.io">Home</a><span>/</span>
	</li>
	<li>
		<a href="http://remoteur.github.io//about">About</a><span>/</span>
	</li>
	<li>
		<a href="http://remoteur.github.io//blog">Blog</a><span>/</span>
	</li>
	<li>
		<a href="https://compute.remote-lab.net" target="_blank">Compute</a><span>/</span>
	</li>
</ul>
                
            </div>
        </header>
        <div class="page-content wc-container">
	
	<div class="post">
		<h1>JunOS config interfaces IP address parser</h1>
		<p class="post-meta">
			
      <span class="categories">
      linux
      </span> |
	    
	    <span class="post-date">
    	Feb 23, 2014 
	    </span>
		</p>		
		<div class="post">
			<p>Hello guys,</p>
<p>In todays post I will show how you can obtain an interface IP address out of a JunOS curly brackets configuration file. You may find below the script and also the source configuration file. Please note that in order to run the script both files need to be placed in the same directory. </p>
<p>Please check it and let me know what you think, it's my first Perl script so it could definitely be improved.</p>
<p><code lang="perl[notools]">#!/usr/bin/perl<br />
open (CONFIG, 'config.txt');<br />
my $data = do { local $/; <config>;};<br />
close (CONFIG);
<p>my $system = $data =~ m{(\bsystem\s*({(?:(?&gt;[^{}]+)|(?-1))*}))}<br />
    ? $1<br />
    : die "system not found";</p>
<p>my $intconfig = $data =~ m{(\binterfaces\s*({(?:(?&gt;[^{}]+)|(?-1))*}))}<br />
    ? $1<br />
    : die "interfaces not found";</p>
<p>if ($ARGV[0] eq 'sys') {<br />
    print $system;<br />
}</p>
<p>if ($ARGV[0] eq 'int') {<br />
    if (!defined $ARGV[1]) {<br />
        print $intconfig, "\n";<br />
    }<br />
    if (defined $ARGV[1]) {<br />
        my $int = $intconfig =~ m{(\b$ARGV[1]\s*({(?:(?&gt;[^{}]+)|(?-1))*}))}<br />
            ? $1<br />
            : die "$ARGV[1] not found";</p>
<p>        if (!defined $ARGV[2]) {<br />
            print $int. "\n";<br />
        }</p>
<p>        if (defined $ARGV[2]) {<br />
            my $unit = $int =~m{(\bunit $ARGV[2]\s*({(?:(?&gt;[^{}]+)|(?-1))*}))}<br />
                ? $1<br />
                : die "$ARGV[2] not found";</p>
<p>            my $inet = $unit =~ m{(\bfamily inet\s*({(?:(?&gt;[^{}]+)|(?-1))*}))}<br />
                ? $1<br />
                : die "family inet not found in section";</p>
<p>            my $inetaddr = $inet =~ m{\baddress\s(\d{1,3}(?:\.\d{1,3}){3})}<br />
                ? $1<br />
                : die "no IP address";<br />
            print $inetaddr, "\n";<br />
        }<br />
    }<br />
}</p>
<p>if ($ARGV[0] eq '--help' or !defined $ARGV[0]) {<br />
    print "Usage : ./parser.pl sys                              # outputs system section config", "\n";<br />
    print "        ./parser.pl int                              # outputs interfaces section config", "\n";<br />
    print "        ./parser.pl int [int-name]                   # outputs specific interface section config", "\n";<br />
    print "        ./parser.pl int ge-1/1/7                     # outputs ge-1/1/7 interface section config", "\n";<br />
    print "        ./parser.pl int [int-name] [unit-id]         # outputs specific interface unit IP address", "\n";<br />
    print "        ./parser.pl int ge-1/1/7 1001                # outputs ge-1/1/7 interface unit 1001 IP address", "\n";<br />
}<br />
</p>
<p><code lang="perl[notools]"><br />
marius@remoteur:~&gt;&gt;&gt; cat config.txt<br />
system {<br />
    host-name junos-device;<br />
    domain-name corporate.net<br />
    time-zone Europe/Bucharest;<br />
    default-address-selection;<br />
    no-redirects;<br />
    location country-code RO;<br />
}<br />
interfaces {<br />
    ge-1/0/0 {<br />
        description "Core: R:core1 RP:ge-0/1/4 (ptp, isis)";<br />
        mtu 9192;<br />
        unit 0 {<br />
            family inet {<br />
                address 192.168.140.29/31;<br />
            }<br />
        }<br />
    }<br />
    ge-1/0/1 {<br />
        description "Cust: R:cust-a RP:ge-1/0/0 (srx240H)";<br />
        unit 0 {<br />
            family inet {<br />
                address 172.16.166.196/30;<br />
            }<br />
        }<br />
    }<br />
    ge-1/0/2 {<br />
        flexible-vlan-tagging;<br />
        native-vlan-id 10;<br />
        mtu 9192;<br />
        unit 10 {<br />
            description "Cust: R:cust-b (data, feed A)";<br />
            vlan-id 10;<br />
            family inet {<br />
                address 192.168.136.184/31;<br />
            }<br />
        }<br />
        unit 1001 {<br />
            description "Core: R:cust-b (cpe management)";<br />
            vlan-id 1001;<br />
            family inet {<br />
                filter {<br />
                    output Protect-cpe;<br />
                }<br />
                address 10.15.4.6/30;<br />
            }<br />
        }<br />
    }<br />
    ae0 {<br />
        description "Core: R:colo-vc2 RI:ae5";<br />
        aggregated-ether-options {<br />
            minimum-links 1;<br />
            link-speed 1g;<br />
        }<br />
        unit 0 {<br />
            family inet {<br />
                address 192.168.140.126/31;<br />
            }<br />
        }<br />
    }<br />
    lo0 {<br />
        unit 0 {<br />
            description "Core: R:primary routing loopback";<br />
            family inet {<br />
                address 192.168.128.166/32;<br />
            }
<p>            }<br />
        }<br />
    }<br />
}<br />
</p>
</code></p></config></code></p>

		</div>
	</div>


	
	<div class="related">
		<h4>Related Posts</h2>
		<ul class="posts">
		    
		    <li>
			  <span>05 Apr 2015 &raquo;</span>
			  <a href="http://remoteur.github.io//uncategorized/linux/virtualization/python/2015/04/05/getting-started-with-docker-and-the-wonders-of-opensource/">Getting started with Docker and the wonders of Open Source</a>
		    </li>
		    
		    <li>
			  <span>24 Feb 2015 &raquo;</span>
			  <a href="http://remoteur.github.io//uncategorized/linux/routing/ios/python/2015/02/24/ospf-lab-provisioning-on-ios-with-ansible/">OSPF lab provisioning on IOS with Ansible</a>
		    </li>
		    
		    <li>
			  <span>12 Oct 2014 &raquo;</span>
			  <a href="http://remoteur.github.io//linux/switching/routing/virtualization/ios/python/2014/10/12/sdn-intro-basic-l2-connectivity-by-using-ovs-and-pox/">SDN Intro: Basic L2 connectivity by using OVS and POX</a>
		    </li>
		    
		</ul>
	</div>
	

	<div class="post-footer">
		<div class="column-1">
			
				<a href="http://remoteur.github.io//linux/switching/routing/virtualization/2014/02/16/linux-l2tp-ethernet-pseudowires/"><< Older</a>
			
		</div>
		<div class="column-2"><a href="http://remoteur.github.io// ">Home</a></div>
		<div class="column-3">
			
				<a href="http://remoteur.github.io//linux/2014/02/23/junos-interfaces-ip-addresses-a-and-ptr-records-generator/">Newer >></a>
			
		</div>
	</div>
</div>
 

        <footer class="main-footer">
            <div class="wc-container">
                <div class="column one">
                    <h6>Few more links</h6>
<ul class="menu">
    <li><a href="http://remoteur.github.io//about">About</a></li>
    <li><a href="http://remoteur.github.io//blogroll">Blogroll</a></li>
</ul>		
                    
                </div>
                <div class="column two">
                    <h6>Follow me</h6>

<ul class="social-media">


    
    <li>
        <a title="remoteur on Twitter" 
            href="https://twitter.com/remoteur" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="remoteur on Github" 
            href="https://github.com/remoteur" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    
    <li>
        <a title="marius.catalin.31542 on Facebook" 
            href="https://facebook.com/marius.catalin.31542" 
            class="facebook wc-img-replace" target="_blank">Facebook</a>
    </li>
    

    

    

    

</ul>
                </div>
            </div>
            <p class="wc-container disclaimer">
                
Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>
            </p>
        </footer>
        <script type="text/javascript">
          /* To avoid render blocking css */
          var cb = function() {
            var l = document.createElement('link'); l.rel = 'stylesheet';
            l.href = 'http://fonts.googleapis.com/css?family=Ubuntu+Mono&subset=latin';
            var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
          };
          var raf = requestAnimationFrame || mozRequestAnimationFrame ||
              webkitRequestAnimationFrame || msRequestAnimationFrame;
          if (raf) raf(cb);
          else window.addEventListener('load', cb);
        </script>
        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="http://remoteur.github.io//assets/js/jquery.min.js"><\/script>')</script>
        <!-- Site js -->
        <script src="http://remoteur.github.io/assets/js/all.js"></script>
        <!-- Google analytics  -->
        
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    </body>        
</html>
