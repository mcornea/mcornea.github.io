<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Pure-FTPd with MySQL backend</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">        
        <meta name="description" content="Harmony is a free responsive jekyll theme by Gayan Virajith and Maheshika Lakmali. Sourced on Github -  https://github.com/gayanvirajith/harmony
">
        <link rel="canonical" 
        href="https://remote-lab.net//pure-ftpd-with-mysql-backend">
        
        <!-- Harmony styles -->
        <link rel="stylesheet" type="text/css" href="https://remote-lab.net/assets/css/main.css">

        <!-- Modernizr js -->
        <script async src="https://remote-lab.net/assets/js/modernizr.js"></script>    

        <!-- IE Fixes -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->        
    </head>
    <body class="theme-base-01">
        <header class="main-header">
            <div class="wc-container">
                <h1><a href="https://remote-lab.net/">remote-lab.net</a></h1>
                <h2>learn by doing</h2>
                <ul>
	<li>
		<a href="https://remote-lab.net">Home</a><span>/</span>
	</li>
	<li>
		<a href="https://remote-lab.net//about">About</a><span>/</span>
	</li>
	<li>
		<a href="https://remote-lab.net//blog">Blog</a><span>/</span>
	</li>
	<li>
		<a href="https://compute.remote-lab.net" target="_blank">Compute</a><span>/</span>
	</li>
</ul>
                
            </div>
        </header>
        <div class="page-content wc-container">
	
	<div class="post">
		<h1>Pure-FTPd with MySQL backend</h1>
		<p class="post-meta">
			
      <span class="categories">
      linux
      </span> |
	    
	    <span class="post-date">
    	Apr 13, 2013 
	    </span>
		</p>		
		<div class="post">
			<p>This is a quick tutorial on how to install a clean FTP server with MySQL user database backend on a Debian based OS:</p>

<hr />

<p>Install MySQL Server, Client and Pure-FTPd server:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">aptitude install mysql-server mysql-client pure-ftpd-mysql</code></pre></div>

<p>Connect to the MySQL server using the local console, create the database, grant privileges for the account the FTP server will use to connect to the DB, create the table that will store the user info and populate it:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">mysql&gt; CREATE DATABASE pureftpd<span class="p">;</span>
mysql&gt; GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP ON pureftpd.* TO <span class="s1">&#39;pureftpd&#39;</span>@<span class="s1">&#39;localhost&#39;</span> IDENTIFIED BY <span class="s1">&#39;ftpdpass&#39;</span><span class="p">;</span>
mysql&gt; FLUSH PRIVILEGES<span class="p">;</span>
mysql&gt; USE pureftpd<span class="p">;</span>
mysql&gt; CREATE TABLE users <span class="o">(</span>
    -&gt; User varchar<span class="o">(</span>16<span class="o">)</span> NOT NULL default <span class="s1">&#39;&#39;</span>,
    -&gt; status enum<span class="o">(</span><span class="s1">&#39;0&#39;</span>,<span class="s1">&#39;1&#39;</span><span class="o">)</span> NOT NULL default <span class="s1">&#39;0&#39;</span>,
    -&gt; Password varchar<span class="o">(</span>64<span class="o">)</span> NOT NULL default <span class="s1">&#39;&#39;</span>,
    -&gt; Uid varchar<span class="o">(</span>11<span class="o">)</span> NOT NULL default <span class="s1">&#39;-1&#39;</span>,
    -&gt; Gid varchar<span class="o">(</span>11<span class="o">)</span> NOT NULL default <span class="s1">&#39;-1&#39;</span>,
    -&gt; Dir varchar<span class="o">(</span>128<span class="o">)</span> NOT NULL default <span class="s1">&#39;&#39;</span>,
    -&gt; comment tinytext NOT NULL,
    -&gt; PRIMARY KEY <span class="o">(</span>User<span class="o">)</span>,
    -&gt; UNIQUE KEY User <span class="o">(</span>User<span class="o">)</span>
    -&gt; <span class="o">)</span> <span class="nv">TYPE</span><span class="o">=</span>MyISAM<span class="p">;</span>
mysql&gt; insert into <span class="sb">`</span>users<span class="sb">`</span>  <span class="o">(</span><span class="sb">`</span>User<span class="sb">`</span>, <span class="sb">`</span>status<span class="sb">`</span>, <span class="sb">`</span>Password<span class="sb">`</span>, <span class="sb">`</span>Uid<span class="sb">`</span>, <span class="sb">`</span>Gid<span class="sb">`</span>, <span class="sb">`</span>Dir<span class="sb">`</span>, <span class="sb">`</span>comment<span class="sb">`</span><span class="o">)</span> values <span class="o">(</span><span class="s1">&#39;ftpuser&#39;</span>, <span class="s1">&#39;1&#39;</span>, md5<span class="o">(</span><span class="s1">&#39;password&#39;</span><span class="o">)</span>, <span class="s1">&#39;33&#39;</span>, <span class="s1">&#39;33&#39;</span>, <span class="s1">&#39;/var/www/&#39;</span>, <span class="s1">&#39;&#39;</span><span class="o">)</span><span class="p">;</span></code></pre></div>

<p>Next, letâ€™s edit the config file used by the PureFTP server to connect to the MySQL server and query the database:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">root@remote-lab:~# vim /etc/pure-ftpd/db/mysql.conf
MYSQLSocket      /var/run/mysqld/mysqld.sock
MYSQLServer     localhost
MYSQLPort       3306
MYSQLUser       pureftpd
MYSQLPassword   ftpdpass
MYSQLDatabase   pureftpd
MYSQLCrypt      md5
MYSQLGetPW      SELECT Password FROM users WHERE <span class="nv">User</span><span class="o">=</span><span class="s2">&quot;\L&quot;</span> AND <span class="nv">status</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
MYSQLGetUID     SELECT Uid FROM users WHERE <span class="nv">User</span><span class="o">=</span><span class="s2">&quot;\L&quot;</span> AND <span class="nv">status</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
MYSQLGetGID     SELECT Gid FROM users WHERE <span class="nv">User</span><span class="o">=</span><span class="s2">&quot;\L&quot;</span>AND <span class="nv">status</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
MYSQLGetDir     SELECT Dir FROM users WHERE <span class="nv">User</span><span class="o">=</span><span class="s2">&quot;\L&quot;</span>AND <span class="nv">status</span><span class="o">=</span><span class="s2">&quot;1&quot;</span></code></pre></div>

<p>A couple of settings I find useful are to chroot the users in their directories and to set PureFTPd not to resolve hostnames. If you want to add users having an UID lower than 1000 you will also have to change the default config file. This is useful for instance if you add ftp users that need access to directories owned by www-data that has 33 UID. </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">&quot;yes&quot;</span> &gt; /etc/pure-ftpd/conf/ChrootEveryone
<span class="nb">echo</span> <span class="s2">&quot;yes&quot;</span> &gt; /etc/pure-ftpd/conf/DontResolve
<span class="nb">echo</span> <span class="s2">&quot;33&quot;</span> &gt; /etc/pure-ftpd/conf/MinUID</code></pre></div>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/etc/init.d/pure-ftpd-mysql restart</code></pre></div>

<p>And we should be up and running. </p>

		</div>
	</div>


	
	<div class="related">
		<h4>Related Posts</h2>
		<ul class="posts">
		    
		    <li>
			  <span>05 Apr 2015 &raquo;</span>
			  <a href="https://remote-lab.net//getting-started-with-docker">Getting started with Docker and the wonders of Open Source</a>
		    </li>
		    
		    <li>
			  <span>24 Feb 2015 &raquo;</span>
			  <a href="https://remote-lab.net//opsf-on-ios-with-ansible">OSPF lab provisioning on IOS with Ansible</a>
		    </li>
		    
		    <li>
			  <span>12 Oct 2014 &raquo;</span>
			  <a href="https://remote-lab.net//sdn-intro-basic-with-ovs-and-pox">SDN Intro: Basic L2 connectivity by using OVS and POX</a>
		    </li>
		    
		</ul>
	</div>
	

	<div class="post-footer">
		<div class="column-1">
			
				<a href="https://remote-lab.net//cisco-ios-dhcp-search-option"><< Older</a>
			
		</div>
		<div class="column-2"><a href="https://remote-lab.net// ">Home</a></div>
		<div class="column-3">
			
				<a href="https://remote-lab.net//routing/ios/2013/04/14/cisco-sdm/">Newer >></a>
			
		</div>
	</div>
</div>
 

        <footer class="main-footer">
            <div class="wc-container">
                <div class="column one">
                    <h6>Few more links</h6>
<ul class="menu">
    <li><a href="https://remote-lab.net//about">About</a></li>
    <li><a href="https://remote-lab.net//blogroll">Blogroll</a></li>
</ul>		
                    
                </div>
                <div class="column two">
                    <h6>Follow me</h6>

<ul class="social-media">


    
    <li>
        <a title="remoteur on Twitter" 
            href="https://twitter.com/remoteur" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="remoteur on Github" 
            href="https://github.com/remoteur" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    
    <li>
        <a title="marius.catalin.31542 on Facebook" 
            href="https://facebook.com/marius.catalin.31542" 
            class="facebook wc-img-replace" target="_blank">Facebook</a>
    </li>
    

    

    

    

</ul>
                </div>
            </div>
            <p class="wc-container disclaimer">
                
Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>
            </p>
        </footer>
        <script type="text/javascript">
          /* To avoid render blocking css */
          var cb = function() {
            var l = document.createElement('link'); l.rel = 'stylesheet';
            l.href = 'http://fonts.googleapis.com/css?family=Ubuntu+Mono&subset=latin';
            var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
          };
          var raf = requestAnimationFrame || mozRequestAnimationFrame ||
              webkitRequestAnimationFrame || msRequestAnimationFrame;
          if (raf) raf(cb);
          else window.addEventListener('load', cb);
        </script>
        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="https://remote-lab.net//assets/js/jquery.min.js"><\/script>')</script>
        <!-- Site js -->
        <script src="https://remote-lab.net/assets/js/all.js"></script>
        <!-- Google analytics  -->
        
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    </body>        
</html>
