<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>SDN Intro: Basic L2 connectivity by using OVS and POX</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">        
        <meta name="description" content="remote-lab.net learn by doing Linux and networking tutorials https://remote-lab.net
">
        <link rel="canonical" 
        href="https://remote-lab.net//sdn-intro-basic-with-ovs-and-pox">
        
        <!-- Harmony styles -->
        <link rel="stylesheet" type="text/css" href="https://remote-lab.net/assets/css/main.css">

        <!-- Modernizr js -->
        <script async src="https://remote-lab.net/assets/js/modernizr.js"></script>    

        <!-- IE Fixes -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->        
    </head>
    <body class="theme-base-01">
        <header class="main-header">
            <div class="wc-container">
                <h1><a href="https://remote-lab.net/">remote-lab.net</a></h1>
                <h2>learn by doing</h2>
                <ul>
	<li>
		<a href="https://remote-lab.net">Home</a><span>/</span>
	</li>
	<li>
		<a href="https://remote-lab.net//about">About</a><span>/</span>
	</li>
	<li>
		<a href="https://remote-lab.net//blog">Blog</a><span>/</span>
	</li>
	<li>
		<a href="https://compute.remote-lab.net" target="_blank">Compute</a><span>/</span>
	</li>
	<li>
		<a href="https://remote-lab.net//docs">Docs</a><span>/</span>
	</li>
</ul>
                
            </div>
        </header>
        <div class="page-content wc-container">
	
	<div class="post">
		<h1>SDN Intro: Basic L2 connectivity by using OVS and POX</h1>
		<p class="post-meta">
			
      <span class="categories">
      linux, switching, routing, and virtualization
      </span> |
	    
	    <span class="post-date">
    	Oct 12, 2014 
	    </span>
		</p>		
		<div class="post">
			<p>You’ve all probably heard about this fancy SDN term that’s been passing around in the networking world in the recent years. I’ll try to explain below what SDN means for me and what are the benefits of using such a model. </p>

<hr />

<p>SDN or Software Defined Networking refers to decoupling the data plane from the control plane. The data plane is the process by which the packets are forwarded and it’s done by the hardware silicon. The control plane is the process that instructs the data plane how to behave (routing protocols, firewall policies, etc). In a typical networking device we find those 2 planes coupled in a single box. The SDN model says we can separate them and keep the packet forwarding on a box that’s got the fast hardware silicon and move the control plane on a general purpose computer. Since the 2 planes are separated they need a means of communication which is OpenFlow. </p>

<p>OpenFlow is a communications protocol that allows remote manipulation of the devices forwarding tables. Think of this protocol like a standard API that you can consume by running any software. This is great because you can purchase the networking device from a specific vendor and run the controller by your own code, open source project or other proprietary software. In my opinion this provides you the freedom to choose and will push the vendors to create better and better software. Personally I’m a big fan of opensource software and I’m dreaming about the moment when the networking world will be able to get the benefits of a big opensource project. 
Another advantage that SDN brings is a central point that controls the network. Think about how we currently manage the networking devices. Even if the network is a whole that provides services to upper applications, we currently log into each separate device and write some commands that configure services. SDN would save us from doing repetitive and boring tasks such as provisioning vlans.
Enough with the talk, let’s start a simple scenario by using the remote-lab.net environment. The lab topology consists of two hosts connected to an OpenvSwitch switch. The OVS switch is connected to an OpenFlow controller running Pox. The controller runs the code that enables L2 connectivity between the hosts but the actual forwarding is done by the OVS switch.
<a href="https://remote-lab.net/assets/static/sdn_lab.png"><img src="https://remote-lab.net/assets/static/sdn_lab.png" alt="sdn_lab" width="686" height="364" class="aligncenter size-full wp-image-284" /></a></p>

<p>Let’s first enable the ports the hosts are connected to, set an openvswitch bridge where the hosts are connected, set the IP addreses on the hosts and check we have connectivity between the hosts. By default the L2 learning mechanism is done by the OpenvSwitch internals. </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">root@ovs01:~&gt;&gt;&gt; ip link <span class="nb">set </span>dev eth1 up
root@ovs01:~&gt;&gt;&gt; ip link <span class="nb">set </span>dev eth2 up
root@ovs01:~&gt;&gt;&gt; ovs-vsctl add-br sw0
root@ovs01:~&gt;&gt;&gt; ovs-vsctl add-port sw0 eth1
root@ovs01:~&gt;&gt;&gt; ovs-vsctl add-port sw0 eth2
root@host01:~&gt;&gt;&gt; ip l <span class="nb">set </span>dev eth1 up
root@host01:~&gt;&gt;&gt; ip addr add 192.168.0.1/24 dev eth1
root@host01:~&gt;&gt;&gt; ip a s dev eth1
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc pfifo_fast state UP qlen 1000
    link/ether 52:54:00:56:e2:b2 brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.1/24 scope global eth1
    inet6 fe80::5054:ff:fe56:e2b2/64 scope link
       valid_lft forever preferred_lft forever
root@host02:~&gt;&gt;&gt; ip l <span class="nb">set </span>dev eth1 up
root@host02:~&gt;&gt;&gt; ip addr add 192.168.0.2/24 dev eth1
root@host02:~&gt;&gt;&gt; ip a s dev eth1
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc pfifo_fast state UP qlen 1000
    link/ether 52:54:00:6e:22:0b brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.2/24 scope global eth1
    inet6 fe80::5054:ff:fe6e:220b/64 scope link
       valid_lft forever preferred_lft forever
root@host02:~&gt;&gt;&gt; ping 192.168.0.1 -c1
PING 192.168.0.1 <span class="o">(</span>192.168.0.1<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
<span class="m">64</span> bytes from 192.168.0.1: <span class="nv">icmp_req</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nb">time</span><span class="o">=</span>0.946 ms
--- 192.168.0.1 ping statistics ---
<span class="m">1</span> packets transmitted, <span class="m">1</span> received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 0.946/0.946/0.946/0.000 ms&lt;/code&gt;</code></pre></div>

<p>Now let’s go to the controller:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">root@ctrl01:~&gt;&gt;&gt; ls
floodlight  pox</code></pre></div>

<p>We see here that we have two directories that contain OpenFlow controller code - Floodlight and Pox. We’ll choose Pox for our example. Pox is platform for the rapid development and prototyping of network control software using Python. Pox comes with some preinstalled components. One of the components is called forwarding.l2_learning and it does what its name says - make OpenFlow switches act as a type of L2 learning switch. You can find the code in the pox/forwarding/l2_learning.py file. We’ll use this component for our example. Let’s start it:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">root@ctrl01:~/pox&gt;&gt;&gt; ./pox.py --verbose forwarding.l2_learning
POX 0.2.0 <span class="o">(</span>carp<span class="o">)</span> / Copyright 2011-2013 James McCauley, et al.
DEBUG:core:POX 0.2.0 <span class="o">(</span>carp<span class="o">)</span> going up...
DEBUG:core:Running on CPython <span class="o">(</span>2.7.3/Jan <span class="m">2</span> <span class="m">2013</span> 13:56:14<span class="o">)</span>
DEBUG:core:Platform is Linux-3.2.0-4-amd64-x86_64-with-debian-7.4
INFO:core:POX 0.2.0 <span class="o">(</span>carp<span class="o">)</span> is up.
DEBUG:openflow.of_01:Listening on 0.0.0.0:6633</code></pre></div>

<p>The next step is to configure OpenvSwitch to use the POX controller. OpenvSwitch has 2 ways of working with an OpenFlow controller - standalone and secure. In standalone mode, if the connection to the controller fails then it will fall back to using its internal logic to install the flows. While in secure mode it will not install any flows if the connection to the controller fails. We’ll use the standalone mode with 172.16.18.6 being the IP address of the POX controller.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">root@ovs01:~&gt;&gt;&gt; ovs-vsctl <span class="nb">set</span>-fail-mode sw0 standalone
root@ovs01:~&gt;&gt;&gt; ovs-vsctl <span class="nb">set</span>-controller sw0 tcp:172.16.18.6:6633
root@ovs01:~&gt;&gt;&gt; ovs-vsctl show
653dfcd6-85a4-4f72-995f-9fa05b5203f9
    Bridge <span class="s2">&quot;sw0&quot;</span>
        Controller <span class="s2">&quot;tcp:172.16.18.6:6633&quot;</span>
            is_connected: <span class="nb">true</span>
<span class="nb">        </span>fail_mode: standalone
        Port <span class="s2">&quot;sw0&quot;</span>
            Interface <span class="s2">&quot;sw0&quot;</span>
                <span class="nb">type</span>: internal
        Port <span class="s2">&quot;eth2&quot;</span>
            Interface <span class="s2">&quot;eth2&quot;</span>
        Port <span class="s2">&quot;eth1&quot;</span>
            Interface <span class="s2">&quot;eth1&quot;</span>
    ovs_version: <span class="s2">&quot;1.9.3&quot;</span></code></pre></div>

<p>We can see the following message on the OpenFlow controller:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">INFO:openflow.of_01:<span class="o">[</span>46-3e-63-ba-e5-46 1<span class="o">]</span> connected
DEBUG:forwarding.l2_learning:Connection <span class="o">[</span>46-3e-63-ba-e5-46 1<span class="o">]</span></code></pre></div>

<p>Let’s see what happens when we try to ping one host from the other:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">DEBUG:forwarding.l2_learning:installing flow <span class="k">for</span> 52:54:00:6e:22:0b.2 -&gt; 52:54:00:56:e2:b2.1
DEBUG:forwarding.l2_learning:installing flow <span class="k">for</span> 52:54:00:56:e2:b2.1 -&gt; 52:54:00:6e:22:0b.2</code></pre></div>

<p>Check the flows that are installed in the switch. Notice how the flows are defined:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">root@ovs01:~&gt;&gt;&gt; ovs-ofctl dump-flows sw0
NXST_FLOW reply <span class="o">(</span><span class="nv">xid</span><span class="o">=</span>0x4<span class="o">)</span>:
 <span class="nv">cookie</span><span class="o">=</span>0x0, <span class="nv">duration</span><span class="o">=</span>7.348s, <span class="nv">table</span><span class="o">=</span>0, <span class="nv">n_packets</span><span class="o">=</span>7, <span class="nv">n_bytes</span><span class="o">=</span>686, <span class="nv">idle_timeout</span><span class="o">=</span>10, <span class="nv">hard_timeout</span><span class="o">=</span>30, <span class="nv">idle_age</span><span class="o">=</span>1, <span class="nv">priority</span><span class="o">=</span>65535,icmp,in_port<span class="o">=</span>2,vlan_tci<span class="o">=</span>0x0000,dl_src<span class="o">=</span>52:54:00:6e:22:0b,dl_dst<span class="o">=</span>52:54:00:56:e2:b2,nw_src<span class="o">=</span>192.168.0.2,nw_dst<span class="o">=</span>192.168.0.1,nw_tos<span class="o">=</span>0,icmp_type<span class="o">=</span>0,icmp_code<span class="o">=</span><span class="m">0</span> <span class="nv">actions</span><span class="o">=</span>output:1
 <span class="nv">cookie</span><span class="o">=</span>0x0, <span class="nv">duration</span><span class="o">=</span>6.329s, <span class="nv">table</span><span class="o">=</span>0, <span class="nv">n_packets</span><span class="o">=</span>6, <span class="nv">n_bytes</span><span class="o">=</span>588, <span class="nv">idle_timeout</span><span class="o">=</span>10, <span class="nv">hard_timeout</span><span class="o">=</span>30, <span class="nv">idle_age</span><span class="o">=</span>1, <span class="nv">priority</span><span class="o">=</span>65535,icmp,in_port<span class="o">=</span>1,vlan_tci<span class="o">=</span>0x0000,dl_src<span class="o">=</span>52:54:00:56:e2:b2,dl_dst<span class="o">=</span>52:54:00:6e:22:0b,nw_src<span class="o">=</span>192.168.0.1,nw_dst<span class="o">=</span>192.168.0.2,nw_tos<span class="o">=</span>0,icmp_type<span class="o">=</span>8,icmp_code<span class="o">=</span><span class="m">0</span> <span class="nv">actions</span><span class="o">=</span>output:2</code></pre></div>

<p>You can take any of these headers and manipulate them as you wish. I believe the whole model provides great flexibility and freedom and it will lead to better networking software. </p>

		</div>
	</div>


	
	<div class="related">
		<h4>Related Posts</h2>
		<ul class="posts">
		    
		    <li>
			  <span>05 Apr 2015 &raquo;</span>
			  <a href="https://remote-lab.net//getting-started-with-docker">Getting started with Docker and the wonders of Open Source</a>
		    </li>
		    
		    <li>
			  <span>24 Feb 2015 &raquo;</span>
			  <a href="https://remote-lab.net//opsf-on-ios-with-ansible">OSPF lab provisioning on IOS with Ansible</a>
		    </li>
		    
		    <li>
			  <span>14 Sep 2014 &raquo;</span>
			  <a href="https://remote-lab.net//ansible-postfix-with-mandrill">Ansible playbook: postfix with Mandrill relay</a>
		    </li>
		    
		</ul>
	</div>
	

	<div class="post-footer">
		<div class="column-1">
			
				<a href="https://remote-lab.net//ansible-postfix-with-mandrill"><< Older</a>
			
		</div>
		<div class="column-2"><a href="https://remote-lab.net// ">Home</a></div>
		<div class="column-3">
			
				<a href="https://remote-lab.net//opsf-on-ios-with-ansible">Newer >></a>
			
		</div>
	</div>
</div>
 

        <footer class="main-footer">
            <div class="wc-container">
                <div class="column one">
                    <h6>Few more links</h6>
<ul class="menu">
    <li><a href="https://remote-lab.net">Home</a></li>
    <li><a href="https://remote-lab.net//about">About</a></li>
    <li><a href="https://remote-lab.net//blogroll">Blogroll</a></li>
    <li><a href="https://remote-lab.net//docs">Docs</a></li>
</ul>		
                    
                </div>
                <div class="column two">
                    <h6>Follow me</h6>

<ul class="social-media">


    
    <li>
        <a title="remoteur on Twitter" 
            href="https://twitter.com/remoteur" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="remoteur on Github" 
            href="https://github.com/remoteur" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    
    <li>
        <a title="marius.catalin.31542 on Facebook" 
            href="https://facebook.com/marius.catalin.31542" 
            class="facebook wc-img-replace" target="_blank">Facebook</a>
    </li>
    

    

    

    

</ul>
                </div>
            </div>
            <p class="wc-container disclaimer">
                
Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>
            </p>
        </footer>
        <script type="text/javascript">
          /* To avoid render blocking css */
          var cb = function() {
            var l = document.createElement('link'); l.rel = 'stylesheet';
            l.href = 'https://fonts.googleapis.com/css?family=Ubuntu+Mono&subset=latin';
            var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
          };
          var raf = requestAnimationFrame || mozRequestAnimationFrame ||
              webkitRequestAnimationFrame || msRequestAnimationFrame;
          if (raf) raf(cb);
          else window.addEventListener('load', cb);
        </script>
        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="https://remote-lab.net//assets/js/jquery.min.js"><\/script>')</script>
        <!-- Site js -->
        <script src="https://remote-lab.net/assets/js/all.js"></script>
        <!-- Google analytics  -->
        
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33897666-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    </body>        
</html>
